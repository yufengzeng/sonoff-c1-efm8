C51 COMPILER V9.53.0.0   KEY                                                               06/07/2018 11:22:27 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\src\key.OBJ
COMPILER INVOKED BY: c:\SiliconLabs\SimplicityStudio\v3\developer\toolchains\keil_8051\9.53\BIN\C51.exe D:\VM\share\EFM8
                    -_PROJ\SONOFF-C1-EFM8\src\key.c OMF2 SMALL DEBUG OBJECTEXTEND ROM(LARGE) WARNINGLEVEL(2) FLOATFUZZY(3) OPTIMIZE(8,SPEED) 
                    -DEFINE(DEBUG=1) INTVECTOR(0X0000) INTPROMOTE INCDIR(D:/VM/share/EFM8_PROJ/SONOFF-C1-EFM8/inc;C:/SiliconLabs/SimplicitySt
                    -udio/v3/developer/sdks/si8051/v3//Device/shared/si8051Base;C:/SiliconLabs/SimplicityStudio/v3/developer/sdks/si8051/v3//
                    -Device/EFM8BB1;C:/SiliconLabs/SimplicityStudio/v3/developer/sdks/si8051/v3//Device/EFM8BB1/inc) PRINT(.\src\key.lst) CON
                    -D PAGEWIDTH(120) PAGELENGTH(65) OBJECT(.\src\key.OBJ)

line level    source

   1          
   2          #include "key.h"
   3          #include "logic.h"
   4          #include "wireless_led.h"
   5          
   6          
   7          
   8          uint16_t sKeyCnt;
   9          uint8_t gValue;
  10          
  11          
  12          SI_SBIT (IO_KEY_CH0, SFR_P0, 7);
  13          
  14          uint8_t GetKey(void)
  15          {
  16   1              uint8_t gTemp = 0;
  17   1              uint8_t toESPKey0Flag = 1;
  18   1      
  19   1          if(!IO_KEY_CH0)
  20   1          {
  21   2             toESPKey0Flag = 0; 
  22   2             gTemp |= 0x01;
  23   2          }
  24   1       
  25   1          if(dev_mode == DEV_NORMAL)
  26   1          {
  27   2              if(chl0_act_period)
  28   2              {
  29   3                  chl0_act_period --;
  30   3                  toESPKey0Flag = 0;
  31   3              }
  32   2          }
  33   1          else
  34   1          {
  35   2              chl0_act_period = 0;
  36   2          }
  37   1         
  38   1          
  39   1          if(toESPKey0Flag)
  40   1          {
  41   2              IO_WIFI_KEY0 = 1;
  42   2          }
  43   1          else
  44   1          {
  45   2              IO_WIFI_KEY0 = 0;
  46   2          }
  47   1      
  48   1              if(gTemp)
  49   1              {
  50   2                      gValue = gTemp;
  51   2                      sKeyCnt++;
C51 COMPILER V9.53.0.0   KEY                                                               06/07/2018 11:22:27 PAGE 2   

  52   2      
  53   2                      if(sKeyCnt >=350)   //3s 300
  54   2                      {
  55   3                          gTemp =gTemp|L_KEY_MASK;
  56   3                          if(sKeyCnt ==350)
  57   3                          {
  58   4                              return (gTemp);
  59   4                          }
  60   3              }
  61   2              if(sKeyCnt >=550)  //5s 500
  62   2                      {
  63   3                          gTemp =gTemp|LL_KEY_MASK;
  64   3                          if(sKeyCnt ==550)
  65   3                          {
  66   4                                      return (gTemp);
  67   4                              }
  68   3                          sKeyCnt = 555;
  69   3              }
  70   2              }
  71   1              else 
  72   1              {
  73   2                  if((sKeyCnt <300)&&(sKeyCnt >=4))
  74   2                  {
  75   3                      sKeyCnt = 0;
  76   3                      return (gValue);
  77   3                  }
  78   2                  else
  79   2                  {
  80   3                      sKeyCnt = 0;
  81   3                  }
  82   2              }
  83   1              return N_KEY;
  84   1      }
  85          
  86          
  87          
  88          
  89          
  90          void Key_Action(void)
  91          {
  92   1              uint8_t gTemp;
  93   1              gTemp = GetKey();
  94   1              if(gTemp == N_KEY) {;}          
  95   1              else if(gTemp == S_KEY_CH0)  
  96   1              {
  97   2              ;
  98   2              }       
  99   1              else if(gTemp == L_KEY_CH0)   
 100   1              {
 101   2              gSelectChl = 0;
 102   2              setDevMode(DEV_STUDY);
 103   2              buzzerTimes(1);
 104   2              }       
 105   1                      
 106   1              else if(gTemp == LL_KEY_CH0)   
 107   1              {
 108   2              gSelectChl = 0;
 109   2              buzzerTimes(2);
 110   2              setDevMode(DEV_CLEAR);
 111   2              }       
 112   1      }
 113          

C51 COMPILER V9.53.0.0   KEY                                                               06/07/2018 11:22:27 PAGE 3   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    194    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
